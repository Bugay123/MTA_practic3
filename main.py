import numpy as np
import pandas as pd

def discriminant_analysis(A, B, X_new):
    """Лінійний дискримінантний аналіз (LDA) для двох класів."""
    mean_A = np.mean(A, axis=0)
    mean_B = np.mean(B, axis=0)

    cov_A = np.cov(A, rowvar=False)
    cov_B = np.cov(B, rowvar=False)
    S_pooled = ((len(A) - 1) * cov_A + (len(B) - 1) * cov_B) / (len(A) + len(B) - 2)
    S_inv = np.linalg.inv(S_pooled)

    w = S_inv @ (mean_A - mean_B)
    c = -0.5 * (mean_A @ S_inv @ mean_A - mean_B @ S_inv @ mean_B)

    scores = X_new @ w + c
    return scores, w, c


def analyze(task_name, A, B, X_new, desc_A, desc_B):
    scores, w, c = discriminant_analysis(A, B, X_new)
    classes = ['A' if s > 0 else 'B' for s in scores]

    df = pd.DataFrame(X_new, columns=['x1', 'x2', 'x3'])
    df['Score'] = np.round(scores, 4)
    df['Class'] = classes

    print(f"\n{'='*90}")
    print(task_name)
    print(df)
    print(f"Коефіцієнти дискримінантної функції w = {np.round(w, 4)}, константа c = {np.round(c, 4)}")

    for i, cl in enumerate(classes, start=9):
        if cl == 'A':
            meaning = f"Підприємство {i} віднесено до класу A ({desc_A}), що свідчить про кращі виробничі показники."
        else:
            meaning = f"Підприємство {i} віднесено до класу B ({desc_B}), що вказує на нижчу ефективність."
        print("Висновок:", meaning)


# === Завдання 1 ===
A1 = np.array([
    [9.26, 1.37, 0.23],
    [9.38, 1.49, 0.39],
    [12.11, 1.44, 0.43],
    [10.81, 1.42, 0.18]
])
B1 = np.array([
    [5.49, 1.10, 0.05],
    [6.61, 1.23, 0.48],
    [4.32, 1.39, 0.41],
    [7.37, 1.38, 0.62]
])
X1 = np.array([[6.7, 0.79, 0.39],
               [9.42, 0.70, 0.72]])
analyze("Завдання 1: Продуктивність праці, коеф. змінності, втрати від браку",
        A1, B1, X1,
        "високопродуктивні підприємства", "низькопродуктивні підприємства")


# === Завдання 2 ===
A2 = np.array([
    [9.26, 1.37, 1.45],
    [9.38, 1.49, 1.30],
    [12.11, 1.44, 1.37],
    [10.81, 1.42, 1.65]
])
B2 = np.array([
    [5.49, 1.10, 1.02],
    [6.61, 1.23, 0.88],
    [4.32, 1.39, 0.62],
    [7.37, 1.38, 1.09]
])
X2 = np.array([[6.7, 0.79, 1.24],
               [9.42, 0.70, 2.03]])
analyze("Завдання 2: Продуктивність, змінність, фондовіддача",
        A2, B2, X2,
        "ефективні підприємства з високою фондовіддачею", "підприємства з нижчою ефективністю використання фондів")


# === Завдання 3 ===
A3 = np.array([
    [9.26, 0.78, 1.37],
    [9.37, 0.79, 1.24],
    [10.02, 0.76, 1.22],
    [10.81, 0.70, 1.42]
])
B3 = np.array([
    [5.49, 0.74, 1.10],
    [6.64, 0.77, 1.35],
    [5.22, 0.79, 1.33],
    [7.37, 0.77, 1.38]
])
X3 = np.array([[12.11, 0.68, 1.44],
               [4.32, 0.68, 1.39]])
analyze("Завдання 3: Продуктивність, питома вага робітників, змінність обладнання",
        A3, B3, X3,
        "підприємства з вищою кваліфікацією персоналу", "підприємства з нижчою продуктивністю праці")


# === Завдання 4 ===
A4 = np.array([
    [4.0, 80, 6.0],
    [4.9, 78.6, 6.3],
    [6.1, 75.9, 7.0],
    [5.3, 74.0, 7.1]
])
B4 = np.array([
    [8.7, 90.7, 9.0],
    [10.3, 94.6, 10.5],
    [11.6, 94.0, 10.9],
    [10.8, 92.5, 11.0]
])
X4 = np.array([[5.5, 74.0, 6.1],
               [9.7, 92.5, 11.1]])
analyze("Завдання 4: Продуктивність, використання сировини, рентабельність продукції",
        A4, B4, X4,
        "менш рентабельні підприємства з нижчим використанням ресурсів", "високорентабельні підприємства")


# === Завдання 5 ===
A5 = np.array([
    [170.5, 10.0, 250.95],
    [200.0, 18.2, 380.6],
    [186.4, 15.8, 300.2],
    [154.2, 10.3, 280.36]
])
B5 = np.array([
    [60.6, 9.0, 100.5],
    [90.8, 9.7, 147.6],
    [100.4, 8.3, 194.3],
    [85.2, 7.9, 170.2]
])
X5 = np.array([[165.3, 17.2, 290.5],
               [170.5, 10.0, 250.95]])
analyze("Завдання 5: Вартість ОПФ, чисельність працюючих, обсяг продукції",
        A5, B5, X5,
        "підприємства з великою потужністю виробництва", "менш потужні підприємства")
